<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>لوحة التحكم - العميل</title>
<link rel="stylesheet" href="style.css">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

</head>
<body>

<div class="header container">
  <div class="logo">⚖️ <span class="lawyer-name">مكتب المحامي محمد العتيبي</span></div>
  <div class="nav">
    <a href="#home">الرئيسية</a>
    <a href="#about">من نحن</a>
    <a href="#services">خدماتنا</a>
    <a href="#cases">قصص نجاح</a>
    <a href="#contact">تواصل</a>
    <a href="#" id="logoutBtn">تسجيل خروج</a>
  </div>
  <div class="menu-toggle">☰</div>
</div>

<main class="container">
  <section class="glass">
    <h2>لوحة التحكم - معلومات العميل</h2>
    <div id="clientInfo">
      <div class="glass-card"><strong>الاسم:</strong> <span id="clientName"></span></div>
      <div class="glass-card"><strong>البريد الإلكتروني:</strong> <span id="clientEmail"></span></div>
      <div class="glass-card"><strong>رقم الهوية:</strong> <span id="clientId"></span></div>
      <div class="glass-card"><strong>المبلغ / القضية:</strong> <span id="clientAmount"></span></div>
      <div class="glass-card"><strong>الحالة:</strong> <span id="clientStatus"></span></div>
    </div>

    <h3>رفع مستند</h3>
    <form id="uploadForm">
      <input type="text" id="message" placeholder="اكتب رسالة أو ملاحظات" required>
      <input type="file" id="fileInput" required>
      <button type="submit">إرسال المستند</button>
    </form>
    <p id="formMsg" style="color:green"></p>
  </section>
</main>

<footer class="container" style="text-align:center;padding:24px 0;color:rgba(255,255,255,0.6)">
  © 2025 مكتب المحامي محمد العتيبي
</footer>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyAzH6gqMdbxKhoZwkWwfJuuopElNRU2JsU",
    authDomain: "alotebi-3500c.firebaseapp.com",
    projectId: "alotebi-3500c",
    storageBucket: "alotebi-3500c.appspot.com",
    messagingSenderId: "99457641243",
    appId: "1:99457641243:web:b9e86295f64e4f652b81be",
    measurementId: "G-HQF5V5FY2L"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

// قائمة الهاتف تعمل على الجوال والكمبيوتر
const menuToggle = document.querySelector('.menu-toggle');
const nav = document.querySelector('.nav');
function toggleNav(e){
  e.preventDefault();
  nav.classList.toggle('show-nav');
}
menuToggle.addEventListener('click', toggleNav);
menuToggle.addEventListener('touchstart', toggleNav);

// التحقق من تسجيل الدخول وجلب بيانات العميل
auth.onAuthStateChanged(async user => {
    if (!user) {
        window.location.href = 'login.html';
        return;
    }

    const doc = await db.collection('clients').doc(user.uid).get();
    if (!doc.exists) {
        alert('لم يتم العثور على بياناتك.');
        return;
    }

    const data = doc.data();
    document.getElementById('clientName').innerText = data.name;
    document.getElementById('clientEmail').innerText = data.email;
    document.getElementById('clientId').innerText = data.idNumber;
    document.getElementById('clientAmount').innerText = data.amount;
    document.getElementById('clientStatus').innerText = data.status;
});

// زر تسجيل خروج
document.getElementById('logoutBtn').addEventListener('click', e => {
    e.preventDefault();
    auth.signOut().then(() => {
        window.location.href = 'login.html';
    });
});

// رفع الملفات على Firebase Storage
const uploadForm = document.getElementById('uploadForm');
const formMsg = document.getElementById('formMsg');

uploadForm.addEventListener('submit', async e => {
    e.preventDefault();
    formMsg.innerText = '';
    const message = document.getElementById('message').value;
    const fileInput = document.getElementById('fileInput');

    if (fileInput.files.length === 0) {
        formMsg.style.color = 'red';
        formMsg.innerText = 'يرجى اختيار ملف';
        return;
    }

    const user = auth.currentUser;
    const file = fileInput.files[0];
    const storageRef = storage.ref(`uploads/${user.uid}/${file.name}`);

    try {
        // رفع الملف
        await storageRef.put(file);
        const downloadURL = await storageRef.getDownloadURL();

        // تخزين الرابط والرسالة في Firestore
        await db.collection('clients').doc(user.uid).collection('uploads').add({
            fileName: file.name,
            fileURL: downloadURL,
            message,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        formMsg.style.color = 'green';
        formMsg.innerText = 'تم رفع المستند بنجاح!';
        uploadForm.reset();
    } catch(err) {
        console.error(err);
        formMsg.style.color = 'red';
        formMsg.innerText = 'حدث خطأ أثناء رفع المستند';
    }
});
</script>

<style>
.glass-card {
  margin: 12px 0;
  padding: 14px;
  border-radius: 18px;
  background: rgba(255,255,255,0.06);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.1);
  box-shadow: 0 10px 30px rgba(0,0,0,0.4);
}
#uploadForm input, #uploadForm button {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.06);
  background: rgba(255,255,255,0.02);
  color: #e6eef8;
}
#uploadForm button {
  background: linear-gradient(90deg,#2f9bff,#5dc1ff);
  color: #042033;
  font-weight: 700;
  cursor: pointer;
}
</style>

</body>
</html>
